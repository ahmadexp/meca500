refactor main function to be readable, write pattern to recreate dipper scenario
